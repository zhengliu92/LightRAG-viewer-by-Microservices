import asyncio
from lightrag.llm import gpt_4o_mini_complete


prompt = """"
-Goal-\nGiven a text document that is potentially relevant to this activity and a list of entity types, identify all entities of those types from the text and all relationships among the identified entities.\nUse CHINESE as output language.\n\n-Steps-\n1. Identify all entities. For each identified entity, extract the following information:\n- entity_name: Name of the entity, use same language as input text. If English, capitalized the name.\n- entity_type: One of the following types: [experiment,material,methodology,result,conclusion,process,property,product,application,advantages,limitations,figure,table].\n- entity_description: Comprehensive description of the entity\'s attributes and activities.\nFormat each entity as ("entity"<|><entity_name><|><entity_type><|><entity_description>)\n\n\n2. From the entities identified in step 1, identify all pairs of (source_entity, target_entity) that are *clearly related* to each other.\nFor each pair of related entities, extract the following information:\n- source_entity: name of the source entity, as identified in step 1\n- target_entity: name of the target entity, as identified in step 1\n- relationship_description: explanation as to why you think the source entity and the target entity are related to each other\n- relationship_strength: a numeric score indicating strength of the relationship between the source entity and target entity\n- relationship_keywords: one or more high-level key words that summarize the overarching nature of the relationship, focusing on concepts or themes rather than specific details\nFormat each relationship as ("relationship"<|><source_entity><|><target_entity><|><relationship_description><|><relationship_keywords><|><relationship_strength>)\n\n3. Identify high-level key words that summarize the main concepts, themes, or topics of the entire text. These should capture the overarching ideas present in the document.\nFormat the content-level key words as ("content_keywords"<|><high_level_keywords>)\n\n4. Return output in CHINESE as a single list of all the entities and relationships identified in steps 1 and 2. Use **##** as the list delimiter.\n\n5. When finished, output <|COMPLETE|>\n\n######################\n-Examples-\n######################\nExample 1:\n\nEntity_types: [experiment, material, methodology, result, conclusion, process, property, product, application, advantages, limitations, figure, table]\nText:\nThe study investigates the tensile strength and thermal stability of 6061 Aluminum Alloy under different annealing conditions. The methodology involved high-temperature annealing at 300°C, 400°C, and 500°C for 1-hour intervals. Results showed a marked increase in ductility at 400°C due to grain boundary stabilization. A scanning electron microscope (SEM) analysis provided insights into microstructural changes. The advantages of this process include improved mechanical properties suitable for aerospace applications. However, limitations arise due to a decrease in ultimate tensile strength at higher temperatures.\n################\nOutput:\n("entity"<|>"6061 Aluminum Alloy"<|>"material"<|>"6061 Aluminum Alloy is the subject of the study, known for its strength and lightweight properties.")##\n("entity"<|>"Tensile Strength"<|>"property"<|>"Tensile Strength is a mechanical property evaluated in the study, indicative of the material\'s ability to withstand tension.")##\n("entity"<|>"Thermal Stability"<|>"property"<|>"Thermal Stability measures the material\'s ability to maintain its properties at elevated temperatures.")##\n("entity"<|>"Annealing"<|>"process"<|>"Annealing is the heat treatment process applied to the material at various temperatures to enhance its properties.")##\n("entity"<|>"Scanning Electron Microscope (SEM)"<|>"methodology"<|>"SEM is a technique used to analyze microstructural changes in the material.")##\n("entity"<|>"Aerospace Applications"<|>"application"<|>"Aerospace Applications refer to the potential uses of the alloy in the aerospace industry due to its enhanced properties.")##\n("entity"<|>"Improved Ductility at 400°C"<|>"result"<|>"The study identified increased ductility at 400°C due to grain boundary stabilization.")##\n("entity"<|>"Decrease in Ultimate Tensile Strength at Higher Temperatures"<|>"limitations"<|>"This limitation reflects the trade-off in material performance with increasing temperature.")##\n("relationship"<|>"6061 Aluminum Alloy"<|>"Annealing"<|>"6061 Aluminum Alloy was subjected to annealing to assess changes in its properties."<|>"heat treatment, property enhancement"<|>9)##\n("relationship"<|>"Annealing"<|>"Tensile Strength"<|>"Annealing directly influenced the tensile strength of the alloy."<|>"process-property interaction"<|>8)##\n("relationship"<|>"SEM"<|>"Microstructural Changes"<|>"SEM analysis was used to observe microstructural changes in the alloy."<|>"analysis, microstructure"<|>7)##\n("relationship"<|>"Improved Ductility at 400°C"<|>"Aerospace Applications"<|>"The enhanced ductility at 400°C makes the material suitable for aerospace applications."<|>"improved property, industrial relevance"<|>8)##\n("content_keywords"<|>"6061 Aluminum Alloy, tensile strength, annealing, thermal stability, aerospace applications, SEM")<|COMPLETE|>\n#############################\nExample 2:\n\nEntity_types: [experiment, material, methodology, result, conclusion, process, property, product, application, advantages, limitations, figure, table]\nText:\nA novel solid-state electrolyte, Sb-doped Li10P3S12I, was synthesized to enhance lithium-ion conductivity. The process involved ball milling followed by hot pressing under inert conditions. The material demonstrated an ionic conductivity of 1.2 mS/cm at room temperature. X-ray diffraction (XRD) confirmed the crystalline structure, and electrochemical impedance spectroscopy (EIS) was employed to validate the conductivity measurements. The key advantages include enhanced safety and thermal stability for solid-state battery applications. However, challenges in large-scale production remain a significant limitation.\n################\nOutput:\n("entity"<|>"Sb-doped Li10P3S12I"<|>"material"<|>"Sb-doped Li10P3S12I is a novel solid-state electrolyte synthesized to improve lithium-ion conductivity.")##\n("entity"<|>"Ball Milling and Hot Pressing"<|>"process"<|>"Ball Milling and Hot Pressing are the processes used for synthesizing the electrolyte under inert conditions.")##\n("entity"<|>"Ionic Conductivity"<|>"property"<|>"Ionic Conductivity is a critical property measured in the electrolyte, reported at 1.2 mS/cm.")##\n("entity"<|>"X-ray Diffraction (XRD)"<|>"methodology"<|>"XRD was used to confirm the crystalline structure of the material.")##\n("entity"<|>"Electrochemical Impedance Spectroscopy (EIS)"<|>"methodology"<|>"EIS validated the ionic conductivity of the synthesized material.")##\n("entity"<|>"Solid-State Battery Applications"<|>"application"<|>"The material is intended for use in solid-state batteries, offering improved safety and stability.")##\n("entity"<|>"Challenges in Large-scale Production"<|>"limitations"<|>"The study highlights difficulties in scaling up the production of the material.")##\n("relationship"<|>"Sb-doped Li10P3S12I"<|>"Ball Milling and Hot Pressing"<|>"Ball Milling and Hot Pressing were employed to synthesize Sb-doped Li10P3S12I."<|>"synthesis, material preparation"<|>9)##\n("relationship"<|>"Ionic Conductivity"<|>"Solid-State Battery Applications"<|>"The high ionic conductivity enhances the material\'s suitability for solid-state battery applications."<|>"property-application correlation"<|>8)##\n("relationship"<|>"XRD"<|>"Sb-doped Li10P3S12I"<|>"XRD was used to confirm the crystalline structure of Sb-doped Li10P3S12I."<|>"characterization, structural analysis"<|>7)##\n("content_keywords"<|>"solid-state electrolyte, Sb-doped Li10P3S12I, ionic conductivity, synthesis, battery applications")<|COMPLETE|>\n#############################\nExample 3:\n\nEntity_types: [experiment, material, methodology, result, conclusion, process, property, product, application, advantages, limitations, figure, table]\nText:\nResearchers developed a polymer composite reinforced with graphene oxide (GO) nanosheets for enhanced mechanical and thermal properties. The composite, referred to as GO/Polymer, was fabricated using solution casting, followed by curing at elevated temperatures. The study provided a detailed analysis of the composite’s tensile strength, thermal stability, and electrical conductivity.\n\nFigure 1 illustrates the microstructure of the GO/Polymer composite, highlighting the uniform dispersion of graphene oxide within the polymer matrix. Table 1 summarizes the mechanical properties of the composite compared to the pristine polymer. The results showed a 50% improvement in tensile strength and a 30% increase in thermal stability. However, the study also noted limitations, such as reduced flexibility at higher GO concentrations. The composite\'s applications in electronics and aerospace were discussed, with emphasis on its lightweight and conductive nature.\n################\nOutput:\n("entity"<|>"GO/Polymer Composite"<|>"material"<|>"The GO/Polymer composite is a material reinforced with graphene oxide nanosheets, designed for enhanced mechanical and thermal properties.")##\n("entity"<|>"Graphene Oxide (GO)"<|>"material"<|>"Graphene Oxide is a nanoscale reinforcement material used in the composite to improve its properties.")##\n("entity"<|>"Solution Casting and Curing"<|>"process"<|>"Solution Casting and Curing are the fabrication methods used to produce the GO/Polymer composite.")##\n("entity"<|>"Tensile Strength"<|>"property"<|>"Tensile Strength refers to the mechanical property of the composite, which increased by 50% compared to the pristine polymer.")##\n("entity"<|>"Thermal Stability"<|>"property"<|>"Thermal Stability is the property measuring the composite\'s resistance to thermal degradation, which increased by 30%.")##\n("entity"<|>"Electrical Conductivity"<|>"property"<|>"Electrical Conductivity describes the composite\'s ability to conduct electricity, enhanced due to the incorporation of graphene oxide.")##\n("entity"<|>"Figure 1"<|>"figure"<|>"Figure 1 shows the microstructure of the GO/Polymer composite, highlighting the dispersion of graphene oxide in the polymer matrix.")##\n("entity"<|>"Table 1"<|>"table"<|>"Table 1 summarizes the mechanical properties of the composite and the pristine polymer, demonstrating improvements in tensile strength and thermal stability.")##\n("entity"<|>"Electronics and Aerospace Applications"<|>"application"<|>"These applications leverage the lightweight and conductive nature of the GO/Polymer composite.")##\n("entity"<|>"Reduced Flexibility at Higher GO Concentrations"<|>"limitations"<|>"The study identifies reduced flexibility as a limitation when the concentration of graphene oxide increases.")##\n("relationship"<|>"GO/Polymer Composite"<|>"Graphene Oxide (GO)"<|>"Graphene Oxide is the reinforcing material used in the GO/Polymer composite."<|>"reinforcement, material enhancement"<|>9)##\n("relationship"<|>"GO/Polymer Composite"<|>"Solution Casting and Curing"<|>"Solution Casting and Curing are the processes used to fabricate the GO/Polymer composite."<|>"fabrication, process-methodology"<|>8)##\n("relationship"<|>"Tensile Strength"<|>"Table 1"<|>"Table 1 quantifies the improvement in tensile strength of the composite compared to the pristine polymer."<|>"quantification, property comparison"<|>7)##\n("relationship"<|>"Thermal Stability"<|>"Figure 1"<|>"Figure 1 visually supports the improved thermal stability by showing the uniform dispersion of graphene oxide."<|>"visualization, property analysis"<|>6)##\n("relationship"<|>"GO/Polymer Composite"<|>"Electronics and Aerospace Applications"<|>"The composite\'s enhanced properties make it suitable for electronics and aerospace applications."<|>"application relevance, industrial use"<|>8)##\n("content_keywords"<|>"polymer composite, graphene oxide, tensile strength, thermal stability, solution casting, aerospace applications, electronics")<|COMPLETE|>\n#############################\n\n#############################\n-Real Data-\n######################\nEntity_types: experiment,material,methodology,result,conclusion,process,property,product,application,advantages,limitations,figure,table\nText: -V curves of PVSCs with different degrees of PTABr post-treatment and without post-treatment. The Voc\n\nwas higher in devices treated with an appropriate amount of PTABr. The PVSCs fabricated with 1 mg PTABr post-treatment of the Cs2PbI2(SCN)2 film gave the champion PCE. The Voc values\n\nPaper\n\nof PVSCs are closely related to interfacial recombination across the whole device. The use of an appropriate amount of PTABr avoids undesirable contact between Cs2PbI2(SCN)2 and the spiro-HTL layers. However, excessive amounts of PTABr are detrimental to the PCE.\n\nPTABr has been reported as a post-treatment for CsPbI3 perovskite films, in which Br-doping (or alloying) affects the underlying perovskite.40 This effect was also found in our experiments. The XRD patterns (Fig. S8+) indicated a shift of characteristic diffraction peaks in the 2D Cs2PbL2(SCN)2 perovskite to higher angles after the post-treatment with PTABr. Hence, Br incorporates into the 2D perovskite lattice. The gradient distribution of Br in CS2PbI2(SCN)2 films is further shown by EDX results (Fig. S9+). The XPS results (Fig. S10+) indicate that compared with the untreated Cs,PbIs(SCN), film, the PTABr post-treated film had new peaks assigned to the Ncontaining components of PTABr. The binding energies of Pb, Cs, I and other atoms assigned to Cs2PbI2(SCN)2 were also lower. This result is consistent with a previous report of the incorporation of Br and the retention of PTA groups at the perovskite surface.40\n\nCs2PbI2(SCN)2 films were found to easily decompose in humid air.33 Photos (Fig. S11 ) showed that the vivid red color of the control Cs2PbI2(SCN)2 film faded almost completely within 12 hours. Although the CS2PbI2(SCN)2 film prepared with the assistance of FACl and PTABr post-treatment was relatively a bit more stable than the other two cases after 12 hour s exposure, decomposition in it had already taken place in the first 4 hours. So, the CS2PbI2(SCN)2-based devices can t be stable in ambient air without encapsulation. Thus, stability measurements of the devices were performed by placing the unencapsulated device in a nitrogen glove box. The changes in the PCE of typical samples over this period are plotted in Fig. 6(d). As seen, the device based on the Cs2PbI (SCN)  film prepared with the assistance of FACl and PTABr post-treatment retained 80.7 percent of its initial efficiency after 800 hours. And it is a bit more stable than the device based on the control perovskite film.\n\n<TEXT in Conclusion 4.>\nThe addition of FACl to precursor solutions effectively improved the growth of 2D Cs2PbI2(SCN)2 crystals by inducing an intermediate phase that regulated the crystallization process, resulting in the formation of perovskites with fewer defects. Delayed crystallization also resulted in films with larger grain sizes. Accordingly, photo-induced carrier lifetimes were increased. Thus, the performance of solar cells based on these films was improved. PTABr was also used as an effective buffer layer to further improve the efficiencies of the solar cells. By both blocking the interaction between CS2PbI2(SCN)2 and spiro-HTL and the doping or alloying effect on the perovskite films of PTABr, the Voc of PVSCs increased. The performance of the asfabricated PVSCs based on 2D CS2PbI2(SCN)2 with a vivid red color herein is the highest reported. This study develops an understanding and fabrication technology for all-inorganic 2D Cs2PbI2(SCN)2 perovskites applied in solar cells.\n\n<Figure in Results and discussion 3.>\nFig. 1  (a) Schematic of the intermediate-modulated method illustrating interface passivation for 2D Cs>Pbl (SCN)  perovskite films. (b) XRD patterns of the Cs,Pbl-(SCN), control sample, films with FACI, and films with FACI with PTABr post-treatment. (c) Cross-sectional SEM image of solar cells with an architecture of FTO/TiO /Cs Pb (SCN) /PTABr/spiro-OMeTAD/Au. (d) J V curves of PVSCs based on 2D Cs Pbl (SCN)  layers, with the inset showing the device architecture. (e) IPCE curves of the three devices.\n\n<Figure in Results and discussion 3.>\nFig. 2   (a) J V curves of PVSCs based on CsyPb/SCN), films prepared with and without the FACl additive. (b) Statistical analysis of the device efficiency for different FACI concentrations collected from 20 PVSCs. (c) XRD patterns of perovskite films prepared with different FACI concentrations and (d) expansions of characteristic peaks.\n\n<Figure in Results and discussion 3.>\nFig. 3   (a) SEM images of Cs Pb (SCN)  films prepared without FACI and (b) with 0.02 M FACl. (c) UV-vis absorption spectra with the inset showing the PL spectra and (d) TRPL spectra for Cs Pbl (SCN)  films prepared with and without the addition of FACl to precursors.\n\n<Figure in Results and discussion 3.>\nFig. 4    (a) XRD patterns of thin films annealed for different times and (b) expansions of characteristic peaks. (c) and (d) XPS patterns of the control film and films prepared with 0.02 M FACl annealed for different times. (e) Space charge limited current curves of electron-only devices based on the Cs.Pb/s/SCN/2 films with 0.02 M FACl annealed for different times. (f) J V curves of PVSCs with 0.02 M FACl annealed for different times.\n\n<Figure in Results and discussion 3.>\nFig. 5   Schematic diagram of the transformation of intermediate phase Cs      -  -CL,(SCN)   to final Cs-Pb)     CLN)   crystals with fewer defects (  vacancies).\n\n<Figure in Results and discussion 3.>\nFig. 6  SEM images of the spiro-based hole transport layer (a) deposited on the surface of Cs Pb (SCN)  directly and (b) on the surface of Cs,Pbl-(SCN), subjected to a post-treatment with PTABr. Insets show the contact angles of spiro-OMeTAD solutions on two kinds of surfaces. (c) J V curves of Cs Pbl {SCN}  based PVSCs without and with different degrees of PTABr post-treatment. (d) Long-term stability of the devices stored in a nitrogen atmosphere at room temperature.\n######################\nOutput:\n

"""
OPENAI_API_KEY = ""
OPENAI_PROJECT_ID = ""


async def test_openai_complete():
    response = await gpt_4o_mini_complete(
        api_key=OPENAI_API_KEY,
        project=OPENAI_PROJECT_ID,
        system_prompt="You are a helpful assistant",
        prompt=prompt,
    )
    print(response)


async def test_openai_complete_stream():
    response = await gpt_4o_mini_complete(
        api_key=OPENAI_API_KEY,
        project=OPENAI_PROJECT_ID,
        system_prompt="You are a helpful assistant",
        prompt=prompt,
        stream=True,
    )
    async for chunk in response:
        print(chunk)


if __name__ == "__main__":
    asyncio.run(test_openai_complete_stream())
